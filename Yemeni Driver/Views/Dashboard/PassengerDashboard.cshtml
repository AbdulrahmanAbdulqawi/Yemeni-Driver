@using Yemeni_Driver.ViewModel.Dashboard
@model PassengerDashboardViewModel


@{
    ViewData["Title"] = "Passenger Dashboard";
    Layout = "_Layout";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="text-center">Welcome, @Model.FirstName!</h4>
                    <h4 class="text-center">@Model.Location!</h4>
                    <img class="card-img-top" src="@Model.Image" width="100%" height="225" alt="Card image cap">

                </div>
                <div class="card-body">
                    <!-- Display any relevant information or statistics about the passenger's account -->

                    <div class="container mt-5">
                        <h2 class="text-center mb-4">Available Drivers</h2>

                        <div class="row">
                            @foreach (var driver in @Model.AvailableDrivers)
                            {
                                <div class="col-md-4 mb-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">@driver.FirstName @driver.LastName</h5>
                                            <p class="card-text">Gender: @driver.Gender</p>
                                            <p class="card-text">Address: @driver.Location</p>
                                            <img class="card-img-top" src="@driver.ProfileImageUrl" width="100%" height="225" alt="Card image cap">
                                            <!-- Add more details or customize as needed -->
                                            <a href="#" class="btn btn-primary">Select Driver</a>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>

                    <div class="text-center mt-3">
                        <h5>Ready for your next ride?</h5>
                        <p>Simply click the button below to request a ride.</p>
                        <button id="requestRideBtn" class="btn btn-primary" asp-controller="Request" asp-action="MakeRequest" onclick="requestRide()">Request Ride</button>
                    </div>

                    <!-- Progress Bar Section -->
                   
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script>
    function updateLiveLocation() {
        navigator.geolocation.getCurrentPosition(function (position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;

            fetch('/api/updateLiveLocation', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ latitude: latitude, longitude: longitude }),
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    console.log('Live location updated successfully.');
                })
                .catch(error => {
                    console.error('Error updating live location:', error);
                });
        });
    }

    // Periodically update live location (e.g., every 5 seconds)
    setInterval(updateLiveLocation, 5000);

</script>

